# åŒ»é™¢å±‚çº§æ‰«æŸ¥å¾®æœåŠ¡

[![Python](https://img.shields.io/badge/Python-3.8%2B-blue.svg)](https://www.python.org/downloads/)
[![FastAPI](https://img.shields.io/badge/FastAPI-latest-green.svg)](https://fastapi.tiangolo.com/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)
[![Docker](https://img.shields.io/badge/Docker-supported-blue.svg)](https://www.docker.com/)

ä¸€ä¸ªåŸºäºFastAPIçš„åŒ»é™¢å±‚çº§æ•°æ®æ‰«æŸ¥å¾®æœåŠ¡ï¼Œæ”¯æŒçœå¸‚åŒºåŒ»é™¢æ•°æ®çš„è‡ªåŠ¨åˆ·æ–°ã€æŸ¥è¯¢å’Œç®¡ç†ã€‚åŸºäºé˜¿é‡Œç™¾ç‚¼LLMæŠ€æœ¯å®ç°æ™ºèƒ½æ•°æ®è·å–ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ¯ æ•°æ®ç®¡ç†
- **å¤šå±‚çº§æ•°æ®**: æ”¯æŒçœã€å¸‚ã€åŒºå¿ã€åŒ»é™¢å››çº§æ•°æ®çš„å­˜å‚¨å’Œç®¡ç†
- **æ™ºèƒ½åˆ·æ–°**: åŸºäºé˜¿é‡Œç™¾ç‚¼LLMçš„æ™ºèƒ½æ•°æ®è·å–ï¼Œæ”¯æŒå…¨é‡åˆ·æ–°å’ŒæŒ‡å®šçœä»½åˆ·æ–°
- **æ•°æ®æŒä¹…åŒ–**: ä½¿ç”¨SQLiteæ•°æ®åº“ï¼Œç¡®ä¿æ•°æ®å¯é å­˜å‚¨

### ğŸ” æŸ¥è¯¢åŠŸèƒ½
- **çµæ´»æŸ¥è¯¢**: æä¾›RESTful APIæ”¯æŒåˆ†é¡µæŸ¥è¯¢å’Œæ¨¡ç³Šæœç´¢
- **å±‚çº§å…³ç³»**: å®Œæ•´æ”¯æŒçœâ†’å¸‚â†’åŒºå¿â†’åŒ»é™¢çš„å±‚çº§å…³ç³»æŸ¥è¯¢
- **é«˜æ€§èƒ½**: ä¼˜åŒ–çš„æ•°æ®åº“æŸ¥è¯¢ï¼Œæ”¯æŒå¤§é‡æ•°æ®çš„å¿«é€Ÿæ£€ç´¢

### ğŸš€ ä»»åŠ¡ç®¡ç†
- **å¼‚æ­¥å¤„ç†**: å¼‚æ­¥ä»»åŠ¡å¤„ç†ï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹
- **è¿›åº¦è·Ÿè¸ª**: å®æ—¶è¿›åº¦è·Ÿè¸ªï¼ˆ0-100%ï¼‰
- **ä»»åŠ¡æ§åˆ¶**: æ”¯æŒä»»åŠ¡åˆ›å»ºã€ç›‘æ§ã€å–æ¶ˆå’Œæ¸…ç†
- **å¹¶å‘æ§åˆ¶**: ä½¿ç”¨ä¿¡å·é‡é™åˆ¶å¹¶å‘æ•°ï¼Œé¿å…èµ„æºè¿‡è½½

### ğŸ›¡ï¸ ç¨³å®šæ€§
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œé”™è¯¯æ¢å¤æœºåˆ¶
- **é‡è¯•æœºåˆ¶**: æŒ‡æ•°é€€é¿é‡è¯•ç­–ç•¥ï¼Œæé«˜æ•°æ®è·å–æˆåŠŸç‡
- **æ—¥å¿—ç³»ç»Ÿ**: è¯¦ç»†çš„æ—¥å¿—è®°å½•ï¼Œæ”¯æŒæ–‡ä»¶å’Œæ§åˆ¶å°è¾“å‡º
- **å¥åº·æ£€æŸ¥**: æä¾›å¥åº·æ£€æŸ¥æ¥å£ï¼Œç›‘æ§æœåŠ¡çŠ¶æ€

### ğŸ“š APIæ–‡æ¡£
- **è‡ªåŠ¨æ–‡æ¡£**: è‡ªåŠ¨ç”ŸæˆSwagger UIå’ŒReDocæ–‡æ¡£
- **äº¤äº’å¼**: æ”¯æŒåœ¨çº¿æµ‹è¯•APIæ¥å£
- **æ ‡å‡†æ ¼å¼**: éµå¾ªOpenAPI 3.0è§„èŒƒ

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### åç«¯æŠ€æœ¯æ ˆ
- **Webæ¡†æ¶**: FastAPI - é«˜æ€§èƒ½å¼‚æ­¥Webæ¡†æ¶
- **æ•°æ®åº“**: SQLite - è½»é‡çº§å…³ç³»å‹æ•°æ®åº“
- **LLMæœåŠ¡**: é˜¿é‡Œç™¾ç‚¼ DashScope API
- **å¼‚æ­¥å¤„ç†**: asyncio - Pythonå¼‚æ­¥ç¼–ç¨‹
- **æ•°æ®éªŒè¯**: Pydantic - æ•°æ®åºåˆ—åŒ–å’ŒéªŒè¯
- **APIæ–‡æ¡£**: OpenAPI 3.0 + Swagger UI
- **å®¹å™¨åŒ–**: Docker + Docker Compose

### ç³»ç»Ÿæ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Web Client    â”‚â”€â”€â”€â–¶â”‚  FastAPI Server â”‚â”€â”€â”€â–¶â”‚   SQLite DB     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚  LLM Client     â”‚
                       â”‚ (é˜¿é‡Œç™¾ç‚¼API)    â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- **Python**: 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬
- **æ“ä½œç³»ç»Ÿ**: Linux, macOS, Windows
- **å†…å­˜**: å»ºè®® 512MB ä»¥ä¸Š
- **ç£ç›˜**: å»ºè®® 1GB ä»¥ä¸Šå¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: ç¨³å®šçš„äº’è”ç½‘è¿æ¥ï¼ˆç”¨äºLLM APIè°ƒç”¨ï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šæœ¬åœ°è¿è¡Œï¼ˆæ¨èï¼‰

1. **å…‹éš†é¡¹ç›®**
   ```bash
   git clone https://github.com/your-org/hospital-scanner.git
   cd hospital-scanner
   ```

2. **åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ**
   ```bash
   python -m venv venv
   source venv/bin/activate  # Linux/macOS
   # venv\Scripts\activate   # Windows
   ```

3. **å®‰è£…ä¾èµ–**
   ```bash
   pip install -r requirements.txt
   ```

4. **é…ç½®ç¯å¢ƒå˜é‡**
   ```bash
   # å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
   cp .env.example .env
   
   # ç¼–è¾‘ .env æ–‡ä»¶ï¼Œè®¾ç½®ä½ çš„é˜¿é‡Œç™¾ç‚¼APIå¯†é’¥
   # DASHSCOPE_API_KEY=your-api-key-here
   ```

5. **åˆå§‹åŒ–æ•°æ®åº“**
   ```bash
   python -c "from db import init_db; init_db()"
   ```

6. **å¯åŠ¨æœåŠ¡**
   ```bash
   # ä½¿ç”¨å¯åŠ¨è„šæœ¬
   chmod +x start.sh
   ./start.sh
   
   # æˆ–ç›´æ¥ä½¿ç”¨uvicorn
   uvicorn main:app --reload --host 0.0.0.0 --port 8000
   ```

### æ–¹å¼äºŒï¼šDockerè¿è¡Œ

1. **æ„å»ºé•œåƒ**
   ```bash
   docker build -t hospital-scanner .
   ```

2. **è¿è¡Œå®¹å™¨**
   ```bash
   docker run -p 8000:8000 \
     -e DASHSCOPE_API_KEY="your-api-key-here" \
     -v $(pwd)/data:/app/data \
     -v $(pwd)/logs:/app/logs \
     hospital-scanner
   ```

### æ–¹å¼ä¸‰ï¼šDocker Composeè¿è¡Œï¼ˆæ¨èï¼‰

1. **é…ç½®ç¯å¢ƒå˜é‡**
   ```bash
   cp .env.example .env
   # ç¼–è¾‘ .env æ–‡ä»¶ï¼Œè®¾ç½®é˜¿é‡Œç™¾ç‚¼APIå¯†é’¥
   ```

2. **å¯åŠ¨æœåŠ¡**
   ```bash
   docker-compose up -d
   ```

3. **æŸ¥çœ‹æ—¥å¿—**
   ```bash
   docker-compose logs -f
   ```

## ğŸ“š APIæ–‡æ¡£

æœåŠ¡å¯åŠ¨åï¼Œå¯é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc
- **OpenAPI JSON**: http://localhost:8000/openapi.json

## ğŸ”Œ APIæ¥å£è¯¦è§£

### æ•°æ®åˆ·æ–°æ¥å£

#### å…¨é‡åˆ·æ–°æ‰€æœ‰æ•°æ®
```http
POST /refresh/all
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "code": 200,
  "message": "å…¨é‡åˆ·æ–°ä»»åŠ¡å·²å¯åŠ¨",
  "data": {
    "task_id": "task_20231121_143052_123456",
    "status": "PENDING",
    "progress": 0
  }
}
```

#### åˆ·æ–°æŒ‡å®šçœä»½æ•°æ®
```http
POST /refresh/province/{province_name}
```

**è·¯å¾„å‚æ•°:**
- `province_name`: çœä»½åç§°ï¼ˆå¦‚ï¼šå¹¿ä¸œçœï¼‰

### æ•°æ®æŸ¥è¯¢æ¥å£

#### è·å–çœä»½åˆ—è¡¨
```http
GET /provinces?page=1&page_size=10
```

**æŸ¥è¯¢å‚æ•°:**
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `page_size`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤10ï¼Œæœ€å¤§100ï¼‰

**å“åº”ç¤ºä¾‹:**
```json
{
  "code": 200,
  "message": "è·å–çœä»½åˆ—è¡¨æˆåŠŸ",
  "data": {
    "items": [
      {
        "id": 1,
        "name": "åŒ—äº¬å¸‚",
        "code": null,
        "updated_at": "2023-11-21T14:30:00"
      }
    ],
    "total": 34,
    "page": 1,
    "page_size": 10,
    "total_pages": 4
  }
}
```

#### è·å–åŸå¸‚åˆ—è¡¨
```http
GET /cities?province={province_name}&page=1&page_size=10
```

#### è·å–åŒºå¿åˆ—è¡¨
```http
GET /districts?city={city_name}&page=1&page_size=10
```

#### è·å–åŒ»é™¢åˆ—è¡¨
```http
GET /hospitals?district={district_name}&page=1&page_size=10
```

#### æ¨¡ç³Šæœç´¢åŒ»é™¢
```http
GET /hospitals/search?q={keyword}&page=1&page_size=10
```

### ä»»åŠ¡ç®¡ç†æ¥å£

#### è·å–ä»»åŠ¡çŠ¶æ€
```http
GET /tasks/{task_id}
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "code": 200,
  "message": "è·å–ä»»åŠ¡çŠ¶æ€æˆåŠŸ",
  "data": {
    "task_id": "task_20231121_143052_123456",
    "hospital_name": "å…¨é‡åˆ·æ–°",
    "query": null,
    "status": "RUNNING",
    "created_at": "2023-11-21T14:30:52",
    "updated_at": "2023-11-21T14:32:15",
    "progress": 45,
    "current_step": "æ­£åœ¨è·å–å¸‚çº§æ•°æ®...",
    "result": null,
    "error_message": null
  }
}
```

#### è·å–æ´»è·ƒä»»åŠ¡
```http
GET /tasks/active
```

#### å–æ¶ˆä»»åŠ¡
```http
DELETE /tasks/{task_id}
```

#### æ¸…ç†æ—§ä»»åŠ¡
```http
POST /tasks/cleanup
```

### ç³»ç»Ÿæ¥å£

#### å¥åº·æ£€æŸ¥
```http
GET /health
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "status": "healthy",
  "timestamp": "2023-11-21T14:35:00",
  "version": "1.0.0"
}
```

#### æ•°æ®ç»Ÿè®¡
```http
GET /statistics
```

## ğŸ“Š æ•°æ®åº“ç»“æ„

### æ•°æ®è¡¨è®¾è®¡

#### çœä»½è¡¨ (provinces)
| å­—æ®µ | ç±»å‹ | æè¿° |
|------|------|------|
| id | INTEGER | ä¸»é”®ï¼Œè‡ªå¢ |
| name | TEXT | çœä»½åç§° |
| code | TEXT | çœä»½ä»£ç ï¼ˆé¢„ç•™ï¼‰ |
| created_at | TEXT | åˆ›å»ºæ—¶é—´ |
| updated_at | TEXT | æ›´æ–°æ—¶é—´ |

#### åŸå¸‚è¡¨ (cities)
| å­—æ®µ | ç±»å‹ | æè¿° |
|------|------|------|
| id | INTEGER | ä¸»é”®ï¼Œè‡ªå¢ |
| province_id | INTEGER | çœä»½IDï¼Œå¤–é”® |
| name | TEXT | åŸå¸‚åç§° |
| code | TEXT | åŸå¸‚ä»£ç ï¼ˆé¢„ç•™ï¼‰ |
| created_at | TEXT | åˆ›å»ºæ—¶é—´ |
| updated_at | TEXT | æ›´æ–°æ—¶é—´ |

#### åŒºå¿è¡¨ (districts)
| å­—æ®µ | ç±»å‹ | æè¿° |
|------|------|------|
| id | INTEGER | ä¸»é”®ï¼Œè‡ªå¢ |
| city_id | INTEGER | åŸå¸‚IDï¼Œå¤–é”® |
| name | TEXT | åŒºå¿åç§° |
| code | TEXT | åŒºå¿ä»£ç ï¼ˆé¢„ç•™ï¼‰ |
| created_at | TEXT | åˆ›å»ºæ—¶é—´ |
| updated_at | TEXT | æ›´æ–°æ—¶é—´ |

#### åŒ»é™¢è¡¨ (hospitals)
| å­—æ®µ | ç±»å‹ | æè¿° |
|------|------|------|
| id | INTEGER | ä¸»é”®ï¼Œè‡ªå¢ |
| district_id | INTEGER | åŒºå¿IDï¼Œå¤–é”® |
| name | TEXT | åŒ»é™¢åç§° |
| website | TEXT | åŒ»é™¢ç½‘ç«™ |
| llm_confidence | REAL | LLMç½®ä¿¡åº¦ |
| created_at | TEXT | åˆ›å»ºæ—¶é—´ |
| updated_at | TEXT | æ›´æ–°æ—¶é—´ |

#### ä»»åŠ¡è¡¨ (tasks)
| å­—æ®µ | ç±»å‹ | æè¿° |
|------|------|------|
| task_id | TEXT | ä»»åŠ¡IDï¼Œä¸»é”® |
| hospital_name | TEXT | åŒ»é™¢åç§°æˆ–ä»»åŠ¡æè¿° |
| query | TEXT | æŸ¥è¯¢æ¡ä»¶ |
| status | TEXT | ä»»åŠ¡çŠ¶æ€ |
| created_at | TEXT | åˆ›å»ºæ—¶é—´ |
| updated_at | TEXT | æ›´æ–°æ—¶é—´ |
| result | TEXT | ä»»åŠ¡ç»“æœï¼ˆJSONï¼‰ |
| error_message | TEXT | é”™è¯¯ä¿¡æ¯ |

### ç´¢å¼•ä¼˜åŒ–

ä¸ºäº†æé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œç³»ç»Ÿåœ¨ä»¥ä¸‹å­—æ®µä¸Šåˆ›å»ºäº†ç´¢å¼•ï¼š
- `cities(province_id)`
- `districts(city_id)`
- `hospitals(district_id)`
- `hospitals(name)` - æ¨¡ç³Šæœç´¢ä¼˜åŒ–

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

| å˜é‡å | å¿…éœ€ | æè¿° | é»˜è®¤å€¼ |
|--------|------|------|--------|
| `DASHSCOPE_API_KEY` | âœ… | é˜¿é‡Œç™¾ç‚¼APIå¯†é’¥ | - |
| `HTTP_PROXY` | âŒ | HTTPä»£ç†åœ°å€ | - |
| `HTTPS_PROXY` | âŒ | HTTPSä»£ç†åœ°å€ | - |
| `HOST` | âŒ | æœåŠ¡ç»‘å®šåœ°å€ | `0.0.0.0` |
| `PORT` | âŒ | æœåŠ¡ç«¯å£ | `8000` |
| `LOG_LEVEL` | âŒ | æ—¥å¿—çº§åˆ« | `INFO` |
| `DB_PATH` | âŒ | æ•°æ®åº“æ–‡ä»¶è·¯å¾„ | `data/hospital_scanner.db` |
| `MAX_CONCURRENT_TASKS` | âŒ | æœ€å¤§å¹¶å‘ä»»åŠ¡æ•° | `5` |

### é…ç½®æ–‡ä»¶

#### .env.example
```bash
# é˜¿é‡Œç™¾ç‚¼APIå¯†é’¥ï¼ˆå¿…éœ€ï¼‰
DASHSCOPE_API_KEY=your-api-key-here

# ä»£ç†è®¾ç½®ï¼ˆå¯é€‰ï¼‰
HTTP_PROXY=
HTTPS_PROXY=

# æœåŠ¡å™¨é…ç½®
HOST=0.0.0.0
PORT=8000
LOG_LEVEL=INFO

# æ•°æ®åº“é…ç½®
DB_PATH=data/hospital_scanner.db

# ä»»åŠ¡é…ç½®
MAX_CONCURRENT_TASKS=5
```

## ğŸ”§ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
hospital-scanner/
â”œâ”€â”€ main.py                 # FastAPIåº”ç”¨å…¥å£
â”œâ”€â”€ db.py                   # æ•°æ®åº“æ“ä½œå±‚
â”œâ”€â”€ llm_client.py           # LLMå®¢æˆ·ç«¯
â”œâ”€â”€ tasks.py                # ä»»åŠ¡ç®¡ç†
â”œâ”€â”€ schemas.py              # æ•°æ®æ¨¡å‹
â”œâ”€â”€ requirements.txt        # Pythonä¾èµ–
â”œâ”€â”€ .env.example           # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ Dockerfile             # Dockeré•œåƒæ„å»º
â”œâ”€â”€ docker-compose.yml     # Dockerç¼–æ’
â”œâ”€â”€ start.sh              # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ data/                 # æ•°æ®åº“æ–‡ä»¶ç›®å½•
â”œâ”€â”€ logs/                 # æ—¥å¿—æ–‡ä»¶ç›®å½•
â””â”€â”€ tests/                # æµ‹è¯•æ–‡ä»¶ç›®å½•
    â”œâ”€â”€ conftest.py
    â”œâ”€â”€ test_*.py
    â””â”€â”€ fixtures/
```

### æ·»åŠ æ–°çš„æŸ¥è¯¢æ¥å£

1. **åœ¨ `db.py` ä¸­æ·»åŠ æ•°æ®åº“æŸ¥è¯¢æ–¹æ³•**
   ```python
   async def get_custom_data(self, param: str, page: int = 1, page_size: int = 10):
       # æ•°æ®åº“æŸ¥è¯¢é€»è¾‘
       pass
   ```

2. **åœ¨ `schemas.py` ä¸­å®šä¹‰å“åº”æ¨¡å‹**
   ```python
   class CustomResponse(BaseModel):
       # å“åº”æ¨¡å‹å®šä¹‰
       pass
   ```

3. **åœ¨ `main.py` ä¸­æ·»åŠ è·¯ç”±å¤„ç†å‡½æ•°**
   ```python
   @app.get("/custom/{param}", response_model=CustomResponse)
   async def custom_endpoint(param: str, page: int = 1, page_size: int = 10):
       # è·¯ç”±å¤„ç†é€»è¾‘
       pass
   ```

### è‡ªå®šä¹‰LLMè°ƒç”¨

ä¿®æ”¹ `llm_client.py` ä¸­çš„promptæ¨¡æ¿ï¼š

```python
async def get_custom_data(self, query: str) -> Dict[str, Any]:
    prompt = f"""
    è‡ªå®šä¹‰promptæ¨¡æ¿ï¼š
    {query}
    
    è¯·æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¿”å›ï¼š
    {{"items": [...]}}
    """
    
    # è°ƒç”¨LLM APIçš„é€»è¾‘
    pass
```

### æ‰©å±•ä»»åŠ¡ç±»å‹

åœ¨ `tasks.py` ä¸­çš„ `TaskManager` ç±»æ·»åŠ æ–°çš„ä»»åŠ¡ç±»å‹ï¼š

```python
async def create_custom_task(self, param: str) -> str:
    task_id = self._generate_task_id()
    
    # åˆ›å»ºä»»åŠ¡è®°å½•
    await self.db.create_task_record(
        task_id=task_id,
        hospital_name=f"è‡ªå®šä¹‰ä»»åŠ¡: {param}",
        status="PENDING"
    )
    
    # å¼‚æ­¥æ‰§è¡Œä»»åŠ¡
    asyncio.create_task(self._execute_custom_task(task_id, param))
    
    return task_id
```

## ğŸ§ª æµ‹è¯•æŒ‡å—

### è¿è¡Œæµ‹è¯•

```bash
# å®‰è£…æµ‹è¯•ä¾èµ–
pip install -r requirements-dev.txt

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
make test

# è¿è¡Œå•å…ƒæµ‹è¯•
make test-unit

# è¿è¡Œé›†æˆæµ‹è¯•
make test-integration

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
make test-coverage

# æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š
make test-report
```

### æµ‹è¯•ç±»å‹

1. **å•å…ƒæµ‹è¯•** (`tests/test_*.py`)
   - æµ‹è¯•å„ä¸ªæ¨¡å—çš„ç‹¬ç«‹åŠŸèƒ½
   - æ¨¡æ‹Ÿå¤–éƒ¨ä¾èµ–ï¼ˆLLM APIç­‰ï¼‰
   - é«˜è¦†ç›–ç‡è¦æ±‚ï¼ˆ>90%ï¼‰

2. **é›†æˆæµ‹è¯•** (`tests/test_integration.py`)
   - æµ‹è¯•æ¨¡å—é—´çš„åä½œ
   - æµ‹è¯•å®Œæ•´çš„APIæµç¨‹
   - ä½¿ç”¨æµ‹è¯•æ•°æ®åº“

3. **ç«¯åˆ°ç«¯æµ‹è¯•** (`tests/test_e2e.py`)
   - æµ‹è¯•å®Œæ•´çš„ç”¨æˆ·åœºæ™¯
   - çœŸå®æ•°æ®æµ‹è¯•
   - æ€§èƒ½åŸºå‡†æµ‹è¯•

### æµ‹è¯•å·¥å…·

- **Pytest**: æµ‹è¯•æ¡†æ¶
- **pytest-cov**: ä»£ç è¦†ç›–ç‡
- **pytest-asyncio**: å¼‚æ­¥æµ‹è¯•æ”¯æŒ
- **httpx**: HTTPå®¢æˆ·ç«¯æµ‹è¯•
- **responses**: HTTPè¯·æ±‚æ¨¡æ‹Ÿ

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—ç³»ç»Ÿ

#### æ—¥å¿—æ–‡ä»¶
- **åº”ç”¨æ—¥å¿—**: `logs/scanner.log` - ä¸»è¦åº”ç”¨æ—¥å¿—
- **è°ƒè¯•æ—¥å¿—**: `logs/debug.log` - è¯¦ç»†è°ƒè¯•ä¿¡æ¯
- **é”™è¯¯æ—¥å¿—**: `logs/error.log` - é”™è¯¯å’Œå¼‚å¸¸

#### æ—¥å¿—çº§åˆ«
- **DEBUG**: è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯
- **INFO**: ä¸€èˆ¬ä¿¡æ¯æ€§æ¶ˆæ¯
- **WARNING**: è­¦å‘Šæ¶ˆæ¯
- **ERROR**: é”™è¯¯æ¶ˆæ¯

### ç›‘æ§æŒ‡æ ‡

#### ç³»ç»ŸæŒ‡æ ‡
- æœåŠ¡å¥åº·çŠ¶æ€
- APIå“åº”æ—¶é—´
- ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€
- æ•°æ®åº“è¿æ¥æ•°

#### ä¸šåŠ¡æŒ‡æ ‡
- æ•°æ®åˆ·æ–°è¿›åº¦
- æŸ¥è¯¢å“åº”æ—¶é—´
- LLMè°ƒç”¨æˆåŠŸç‡
- ä»»åŠ¡é˜Ÿåˆ—é•¿åº¦

### æ—¥å¿—æŸ¥çœ‹å‘½ä»¤

```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f logs/scanner.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep ERROR logs/scanner.log

# æŸ¥çœ‹ç‰¹å®šä»»åŠ¡æ—¥å¿—
grep "task_20231121_143052_123456" logs/scanner.log

# æŸ¥çœ‹LLMè°ƒç”¨æ—¥å¿—
grep "LLM" logs/scanner.log
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. APIå¯†é’¥é”™è¯¯
**ç—‡çŠ¶**: LLMè°ƒç”¨è¿”å›401é”™è¯¯
```json
{
  "error": {
    "code": "INVALID_API_KEY",
    "message": "API key is invalid"
  }
}
```

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ `DASHSCOPE_API_KEY` ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®è®¾ç½®
2. ç¡®è®¤APIå¯†é’¥æœ‰æ•ˆä¸”æœªè¿‡æœŸ
3. æ£€æŸ¥APIå¯†é’¥æƒé™

#### 2. æ•°æ®åº“è¿æ¥å¤±è´¥
**ç—‡çŠ¶**: æœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œæç¤ºæ•°æ®åº“é”™è¯¯
```
sqlite3.OperationalError: unable to open database file
```

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ `data/` ç›®å½•æ˜¯å¦å­˜åœ¨ä¸”æœ‰å†™æƒé™
2. ç¡®è®¤æ•°æ®åº“æ–‡ä»¶è·¯å¾„æ­£ç¡®
3. è¿è¡Œæ•°æ®åº“åˆå§‹åŒ–ï¼š`python -c "from db import init_db; init_db()"`

#### 3. LLMè°ƒç”¨å¤±è´¥
**ç—‡çŠ¶**: ä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œæç¤ºç½‘ç»œé”™è¯¯
```
requests.exceptions.ConnectionError: HTTPSConnectionPool
```

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. é…ç½®ä»£ç†è®¾ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰
3. æ£€æŸ¥é˜¿é‡Œç™¾ç‚¼APIæœåŠ¡çŠ¶æ€

#### 4. ä»»åŠ¡æ‰§è¡Œè¶…æ—¶
**ç—‡çŠ¶**: ä»»åŠ¡é•¿æ—¶é—´åœç•™åœ¨RUNNINGçŠ¶æ€

**è§£å†³æ–¹æ¡ˆ**:
1. æŸ¥çœ‹æ—¥å¿—ï¼š`tail -f logs/scanner.log | grep "task_id"`
2. æ£€æŸ¥LLM APIå“åº”æ—¶é—´
3. è€ƒè™‘è°ƒæ•´è¶…æ—¶è®¾ç½®

### è°ƒè¯•æŠ€å·§

#### å¯ç”¨è°ƒè¯•æ¨¡å¼
```bash
export LOG_LEVEL=DEBUG
uvicorn main:app --reload --log-level debug
```

#### æ•°æ®åº“æŸ¥è¯¢æµ‹è¯•
```python
import asyncio
from db import get_db

async def test_db():
    db = get_db()
    provinces = await db.get_provinces()
    print(provinces)

asyncio.run(test_db())
```

#### LLMå®¢æˆ·ç«¯æµ‹è¯•
```python
import asyncio
from llm_client import LLMClient

async def test_llm():
    client = LLMClient()
    result = await client.get_provinces()
    print(result)

asyncio.run(test_llm())
```

## ğŸ”„ æ›´æ–°å’Œç»´æŠ¤

### æ•°æ®å¤‡ä»½
```bash
# å¤‡ä»½æ•°æ®åº“
cp data/hospital_scanner.db data/hospital_scanner_backup_$(date +%Y%m%d_%H%M%S).db

# å¤‡ä»½é…ç½®æ–‡ä»¶
cp .env .env_backup_$(date +%Y%m%d_%H%M%S)
```

### ç‰ˆæœ¬å‡çº§
1. å¤‡ä»½ç°æœ‰æ•°æ®
2. æ›´æ–°ä»£ç 
3. è¿è¡Œæ•°æ®åº“è¿ç§»ï¼ˆå¦‚æœæœ‰ï¼‰
4. é‡å¯æœåŠ¡
5. éªŒè¯åŠŸèƒ½æ­£å¸¸

### æ€§èƒ½ä¼˜åŒ–
1. å®šæœŸæ¸…ç†æ—§ä»»åŠ¡è®°å½•
2. ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢ç´¢å¼•
3. ç›‘æ§LLM APIè°ƒç”¨é¢‘ç‡
4. è°ƒæ•´å¹¶å‘ä»»åŠ¡æ•°é‡

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿å„ç§å½¢å¼çš„è´¡çŒ®ï¼è¯·é˜…è¯» [CONTRIBUTING.md](CONTRIBUTING.md) äº†è§£è¯¦ç»†ä¿¡æ¯ã€‚

### è´¡çŒ®æ–¹å¼
- ğŸ› æŠ¥å‘ŠBug
- ğŸ’¡ æå‡ºæ–°åŠŸèƒ½å»ºè®®
- ğŸ“ æ”¹è¿›æ–‡æ¡£
- ğŸ”§ æäº¤ä»£ç ä¿®å¤
- ğŸ’¬ å‚ä¸è®¨è®º

### å¼€å‘å·¥ä½œæµ
1. Forkæœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT è®¸å¯è¯](LICENSE) - æŸ¥çœ‹è®¸å¯è¯æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ“ æ”¯æŒå’Œåé¦ˆ

### è·å–å¸®åŠ©
- ğŸ“š æŸ¥çœ‹ [docs/](docs/) ç›®å½•ä¸‹çš„è¯¦ç»†æ–‡æ¡£
- ğŸ” æœç´¢ç°æœ‰çš„ [Issues](https://github.com/your-org/hospital-scanner/issues)
- ğŸ’¬ å‚ä¸ [Discussions](https://github.com/your-org/hospital-scanner/discussions)

### æŠ¥å‘Šé—®é¢˜
è¯·åœ¨ [GitHub Issues](https://github.com/your-org/hospital-scanner/issues) ä¸­æŠ¥å‘Šé—®é¢˜ï¼ŒåŒ…å«ï¼š
- è¯¦ç»†çš„é—®é¢˜æè¿°
- å¤ç°æ­¥éª¤
- é¢„æœŸè¡Œä¸ºå’Œå®é™…è¡Œä¸º
- ç¯å¢ƒä¿¡æ¯ï¼ˆæ“ä½œç³»ç»Ÿã€Pythonç‰ˆæœ¬ç­‰ï¼‰
- ç›¸å…³æ—¥å¿—

### åŠŸèƒ½è¯·æ±‚
æˆ‘ä»¬å¾ˆä¹æ„å¬åˆ°æ‚¨çš„æƒ³æ³•ï¼è¯·åœ¨ [GitHub Discussions](https://github.com/your-org/hospital-scanner/discussions) ä¸­æå‡ºåŠŸèƒ½è¯·æ±‚ã€‚

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š
- [FastAPI](https://fastapi.tiangolo.com/) - ç°ä»£åŒ–çš„Python Webæ¡†æ¶
- [Pydantic](https://pydantic-docs.helpmanual.io/) - æ•°æ®éªŒè¯åº“
- [é˜¿é‡Œç™¾ç‚¼](https://dashscope.console.aliyun.com/) - LLMæœåŠ¡å¹³å°

---

**æ³¨æ„**: è¯·ç¡®ä¿åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è®¾ç½®é€‚å½“çš„APIå¯†é’¥å’Œç›‘æ§ç­–ç•¥ã€‚å»ºè®®å®šæœŸå¤‡ä»½æ•°æ®åº“ï¼Œå¹¶ç›‘æ§æœåŠ¡æ€§èƒ½ã€‚

## ğŸ“Š é¡¹ç›®ç»Ÿè®¡

[![GitHub stars](https://img.shields.io/github/stars/your-org/hospital-scanner?style=social)](https://github.com/your-org/hospital-scanner)
[![GitHub forks](https://img.shields.io/github/forks/your-org/hospital-scanner?style=social)](https://github.com/your-org/hospital-scanner/fork)
[![GitHub issues](https://img.shields.io/github/issues/your-org/hospital-scanner)](https://github.com/your-org/hospital-scanner/issues)
[![GitHub pull requests](https://img.shields.io/github/issues-pr/your-org/hospital-scanner)](https://github.com/your-org/hospital-scanner/pulls)