# DELETE `/database/clear`

- 入口：`code/hospital_scanner/main.py:113`，调用 `db.clear_all_tables_data()`（`db.py` 末尾）。
- 作用：清空所有业务表数据但保留结构。

## 执行流程
1. 记录日志后调用异步封装的 `clear_all_data`。
2. `db.clear_all_tables_data` 遍历 sqlite 中的非系统表，按固定顺序删除数据（先子表后父表），再尝试重置 `sqlite_sequence`。
3. 成功返回 code 200 的字典，否则抛 HTTP 500。

## 设计原因
- 提供一键回到“空库”状态，便于调试和重复试验。

## 优点
- 顺序删除避免外键残留。
- 返回时间戳，便于确认操作时间。

## 缺点与风险
- 无鉴权/确认，生产环境会导致不可逆数据丢失。
- 清理逻辑同步运行，可能阻塞事件循环；出错时未做事务包裹，可能出现部分表被清空的半失败状态。
- 重置 `sqlite_sequence` 针对自增列，但部分表（如 `tasks.task_id`）为文本主键，重置无意义。

## 改进建议
- 增加鉴权、二次确认与只读模式保护。
- 使用事务包裹整个清理过程并在失败时回滚。
- 拆分出“软清理”（仅测试数据）与“硬清理”（全删），并暴露幂等/幂等标识。
