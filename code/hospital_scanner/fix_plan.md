# 医院层级扫查微服务 - 问题修复计划

## 需要修复的问题

### 1. 任务创建测试失败 (test_scan_task_creation)
**问题**: 测试中LLM客户端mock设置不正确
**修复方案**: 
- 在测试中正确mock LLM客户端
- 确保任务创建逻辑正常工作

### 2. 任务列表测试失败 (test_list_tasks)
**问题**: 任务列表查询方法实现有缺陷
**修复方案**:
- 修复数据库任务列表查询
- 确保测试环境数据库正确初始化

### 3. 分页边界测试失败 (test_pagination_edge_cases)
**问题**: 分页参数边界值处理不当
**修复方案**:
- 在get_provinces等方法中添加参数验证
- 处理page=0、page=-1、page_size=0等边界值

### 4. 错误处理测试失败 (test_error_handling)
**问题**: 404错误响应格式问题
**修复方案**:
- 确保HTTPException正确格式化
- 统一错误响应格式

### 5. 并发测试超时
**问题**: 测试环境资源限制或死锁
**修复方案**:
- 优化测试用例，避免死锁
- 设置适当的超时时间

## 修复步骤
1. 修复数据库分页逻辑
2. 修复任务管理相关代码
3. 更新测试用例
4. 重新运行测试验证
